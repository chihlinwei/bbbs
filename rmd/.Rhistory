#geom_label_repel(data=mac_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
#           fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-1.2, y=1.5, label=stress, size=5) +
#geom_label_repel(data=mac_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
#           fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-1.2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mac_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# ordisurf:
mac_or <- ordisurf(mac_wa[,-3], mac_wa$labe)
summary(mac_or)
# ordisurf:
mac_or <- ordisurf(mac_wa[,-3], mac_wa$labe)
summary(mac_or)
mac_gr <- expand.grid(x = mac_or$grid$x, y = mac_or$grid$y) #get x and ys
mac_gr$z <- as.vector(mac_or$grid$z) #unravel the matrix for the z scores
mac_gr <- data.frame(na.omit(mac_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mac_md$points[,1]),  max(mac_md$points[,1]), len = 10), x2= seq(min(mac_md$points[,2]),  max(mac_md$points[,2]), len=10))
mac_gr2 <- cbind(newdata, z= predict(mac_or, newdata))
names(mac_gr2) <- c("x", "y", "z")
ggplot()+
stat_contour(data = mac_gr, aes(x = x, y = y, z = z, colour=..level..))+
geom_text_contour(data = mac_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#stat_ellipse(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, colour=Habitat), type="norm")+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-1, y=1.5, label=stress, size=5) +
theme_bw() %+replace% large
ggplot()+
stat_ellipse(data=cbind(mac_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mac_gr, aes(x = x, y = y, z = z, colour=..level..))+
geom_text_contour(data = mac_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-1, y=1.5, label=stress, size=5) +
theme_bw() %+replace% large
ggplot()+
stat_ellipse(data=cbind(mac_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mac_gr, aes(x = x, y = y, z = z, colour=..level..))+
geom_text_contour(data = mac_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-1.2, y=1.5, label=stress, size=5) +
theme_bw() %+replace% large
ggplot()+
stat_ellipse(data=cbind(mei_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mei_gr, aes(x = x, y = y, z = z, colour=..level..), binwidth = 0.5)+
geom_text_contour(data = mei_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-2, y=1.5, label=stress, size=5)+
theme_bw() %+replace% large
# ordisurf:
mei_or <- ordisurf(mei_wa[,-3], mei_wa$label)
summary(mei_or)
mei_gr <- expand.grid(x = mei_or$grid$x, y = mei_or$grid$y) #get x and ys
mei_gr$z <- as.vector(mei_or$grid$z) #unravel the matrix for the z scores
mei_gr <- data.frame(na.omit(mei_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mei_md$points[,1]),  max(mei_md$points[,1]), len = 10), x2= seq(min(mei_md$points[,2]),  max(mei_md$points[,2]), len=10))
mei_gr2 <- cbind(newdata, z= predict(mei_or, newdata))
names(mei_gr2) <- c("x", "y", "z")
ggplot()+
stat_ellipse(data=cbind(mei_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mei_gr, aes(x = x, y = y, z = z, colour=..level..), binwidth = 0.5)+
geom_text_contour(data = mei_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-2, y=1.5, label=stress, size=5)+
theme_bw() %+replace% large
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
# NMDS
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
# Weighted Averages Scores
mei_wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
mei_wa$label <- row.names(mei_wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mei_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# ordisurf:
mei_or <- ordisurf(mei_wa[,-3], mei_wa$label)
summary(mei_or)
mei_gr <- expand.grid(x = mei_or$grid$x, y = mei_or$grid$y) #get x and ys
mei_gr$z <- as.vector(mei_or$grid$z) #unravel the matrix for the z scores
mei_gr <- data.frame(na.omit(mei_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mei_md$points[,1]),  max(mei_md$points[,1]), len = 10), x2= seq(min(mei_md$points[,2]),  max(mei_md$points[,2]), len=10))
mei_gr2 <- cbind(newdata, z= predict(mei_or, newdata))
names(mei_gr2) <- c("x", "y", "z")
ggplot()+
stat_ellipse(data=cbind(mei_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mei_gr, aes(x = x, y = y, z = z, colour=..level..), binwidth = 0.5)+
geom_text_contour(data = mei_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-2, y=1.5, label=stress, size=5)+
theme_bw() %+replace% large
mac_s$Class <- cut(mac_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mac_sc <- acast(mac_s, Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)[-39,]
fr <- strsplit(row.names(mac_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube")
# nMDS
mac_md <- metaMDS(mac_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
# Weighted Averages Scores
mac_wa <- wascores(mac_md$points, mac_sc, expand = TRUE) %>% as.data.frame
mac_wa$label <- row.names(mac_wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-1.2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mac_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-1.2, y=1.2, label=stress, size=5) +
geom_label_repel(data=mac_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# ordisurf:
mac_or <- ordisurf(mac_wa[,-3], mac_wa$labe)
summary(mac_or)
mac_gr <- expand.grid(x = mac_or$grid$x, y = mac_or$grid$y) #get x and ys
mac_gr$z <- as.vector(mac_or$grid$z) #unravel the matrix for the z scores
mac_gr <- data.frame(na.omit(mac_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mac_md$points[,1]),  max(mac_md$points[,1]), len = 10), x2= seq(min(mac_md$points[,2]),  max(mac_md$points[,2]), len=10))
mac_gr2 <- cbind(newdata, z= predict(mac_or, newdata))
names(mac_gr2) <- c("x", "y", "z")
ggplot()+
stat_ellipse(data=cbind(mac_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mac_gr, aes(x = x, y = y, z = z, colour=..level..))+
geom_text_contour(data = mac_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-1.2, y=1.2, label=stress, size=5) +
theme_bw() %+replace% large
ggplot()+
stat_ellipse(data=cbind(mac_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
#stat_contour(data = mac_gr, aes(x = x, y = y, z = z, colour=..level..))+
geom_text_contour(data = mac_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-1.2, y=1.2, label=stress, size=5) +
theme_bw() %+replace% large
ggplot()+
stat_ellipse(data=cbind(mac_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
#stat_contour(data = mac_gr, aes(x = x, y = y, z = z, colour=..level..))+
#geom_text_contour(data = mac_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-1.2, y=1.2, label=stress, size=5) +
theme_bw() %+replace% large
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
# NMDS
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
# Weighted Averages Scores
mei_wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
mei_wa$label <- row.names(mei_wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mei_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
fr
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station")
fr
head(mei_s)
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station")
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
ffr
fr
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
fr
?adonis
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=mean)
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
mei_sc2
# Main effect
adonis(mei_sc2~Habitat+Depth+Cruise+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=mean, na.rm=TRUE)
mei_sc2
mei_sc
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=sum, na.rm=TRUE)
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
# Main effect
adonis(mei_sc2~Habitat+Depth+Cruise+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_sc2
donis(mei_sc2~Habitat+Depth+Cruise+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
adonis(mei_sc2~Habitat+Depth+Cruise+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
# Main effect
adonis(mei_sc2~Habitat+Cruise, data=fr, method="bray")
# Main effect
adonis(mei_sc2~Habitat+Cruise+Depth, data=fr, method="bray")
str(fr)
fr$Depth <- as.numeric(fr$Depth)
str(fr)
# Main effect
adonis(mei_sc2~Habitat+Cruise+Depth, data=fr, method="bray")
# Main effect
adonis(mei_sc2~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=mean, na.rm=TRUE)
is.na(mei_sc2)
mei_sc2[is.na(mei_sc2)] <- 0
mei_sc2
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# Main effect
adonis(mei_sc2~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
# NMDS
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
# Main effect
adonis(mei_sc~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
# PERMANOVA Main effect
adonis(mei_sc~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# PERMANOVA Main effect
adonis(mei_sc~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# PERMANOVA Main effect
adonis(mei_sc~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
# NMDS
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
# Weighted Averages Scores
mei_wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
mei_wa$label <- row.names(mei_wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mei_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# PERMANOVA Main effect
adonis(mei_sc~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# PERMANOVA Main effect
adonis(mei_sc~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
# nMDS
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
# Weighted Averages Scores
mei_wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
mei_wa$label <- row.names(mei_wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mei_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# ordisurf:
mei_or <- ordisurf(mei_wa[,-3], mei_wa$label, plot = FALSE)
summary(mei_or)
mei_gr <- expand.grid(x = mei_or$grid$x, y = mei_or$grid$y) #get x and ys
mei_gr$z <- as.vector(mei_or$grid$z) #unravel the matrix for the z scores
mei_gr <- data.frame(na.omit(mei_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mei_md$points[,1]),  max(mei_md$points[,1]), len = 10), x2= seq(min(mei_md$points[,2]),  max(mei_md$points[,2]), len=10))
mei_gr2 <- cbind(newdata, z= predict(mei_or, newdata))
names(mei_gr2) <- c("x", "y", "z")
ggplot()+
stat_ellipse(data=cbind(mei_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mei_gr2, aes(x = x, y = y, z = z, colour=..level..), binwidth = 0.5)+
geom_text_contour(data = mei_gr2, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-2, y=1.5, label=stress, size=5)+
theme_bw() %+replace% large
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=mean, na.rm=TRUE)
mei_sc2[is.na(mei_sc2)] <- 0
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# Main effect
adonis(mei_sc2~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# nMDS
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
# Weighted Averages Scores
mei_wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
mei_wa$label <- row.names(mei_wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mei_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# ordisurf:
mei_or <- ordisurf(mei_wa[,-3], mei_wa$label, plot = FALSE)
summary(mei_or)
mei_gr <- expand.grid(x = mei_or$grid$x, y = mei_or$grid$y) #get x and ys
mei_gr$z <- as.vector(mei_or$grid$z) #unravel the matrix for the z scores
mei_gr <- data.frame(na.omit(mei_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mei_md$points[,1]),  max(mei_md$points[,1]), len = 10), x2= seq(min(mei_md$points[,2]),  max(mei_md$points[,2]), len=10))
mei_gr2 <- cbind(newdata, z= predict(mei_or, newdata))
names(mei_gr2) <- c("x", "y", "z")
ggplot()+
stat_ellipse(data=cbind(mei_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
stat_contour(data = mei_gr2, aes(x = x, y = y, z = z, colour=..level..), binwidth = 0.5)+
geom_text_contour(data = mei_gr2, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-2, y=1.5, label=stress, size=5)+
theme_bw() %+replace% large
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=mean, na.rm=TRUE)
mei_sc2[is.na(mei_sc2)] <- 0
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# Main effect
adonis(mei_sc2~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mac_s$Class <- cut(mac_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mac_sc <- acast(mac_s, Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)[-39,]
fr <- strsplit(row.names(mac_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube")
# nMDS
mac_md <- metaMDS(mac_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
# Weighted Averages Scores
mac_wa <- wascores(mac_md$points, mac_sc, expand = TRUE) %>% as.data.frame
mac_wa$label <- row.names(mac_wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-1.2, y=1.2, label=stress, size=5) +
geom_label_repel(data=mac_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# ordisurf:
mac_or <- ordisurf(mac_wa[,-3], mac_wa$labe)
summary(mac_or)
mac_gr <- expand.grid(x = mac_or$grid$x, y = mac_or$grid$y) #get x and ys
mac_gr$z <- as.vector(mac_or$grid$z) #unravel the matrix for the z scores
mac_gr <- data.frame(na.omit(mac_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mac_md$points[,1]),  max(mac_md$points[,1]), len = 10), x2= seq(min(mac_md$points[,2]),  max(mac_md$points[,2]), len=10))
mac_gr2 <- cbind(newdata, z= predict(mac_or, newdata))
names(mac_gr2) <- c("x", "y", "z")
# ordisurf:
mac_or <- ordisurf(mac_wa[,-3], mac_wa$labe, plot=FALSE)
summary(mac_or)
mac_gr <- expand.grid(x = mac_or$grid$x, y = mac_or$grid$y) #get x and ys
mac_gr$z <- as.vector(mac_or$grid$z) #unravel the matrix for the z scores
mac_gr <- data.frame(na.omit(mac_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mac_md$points[,1]),  max(mac_md$points[,1]), len = 10), x2= seq(min(mac_md$points[,2]),  max(mac_md$points[,2]), len=10))
mac_gr2 <- cbind(newdata, z= predict(mac_or, newdata))
names(mac_gr2) <- c("x", "y", "z")
ggplot()+
stat_ellipse(data=cbind(mac_md$points, fr), geom = "polygon", aes(x=MDS1, y=MDS2, fill=Habitat), alpha = 0.2, type="norm")+
#stat_contour(data = mac_gr, aes(x = x, y = y, z = z, colour=..level..))+
#geom_text_contour(data = mac_gr, aes(x = x, y = y, z = z), colour="#08306b")+
geom_point(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat), pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
labs(x="MDS1", y="MDS2", colour="Size")+
annotate("text", x=-1.2, y=1.2, label=stress, size=5) +
theme_bw() %+replace% large
mac_sc2 <- acast(mac_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=mean, na.rm=TRUE)
mac_sc2[is.na(mac_sc2)] <- 0
fr <- strsplit(row.names(mac_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# Main effect
adonis(mac_sc2~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
library(knitr)
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore+Depth~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# nMDS
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
# Weighted Averages Scores
mei_wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
mei_wa$label <- row.names(mei_wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
stat_ellipse(type="norm", geom="polygon", alpha=0.2, colour="transparent")+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=mei_wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# ordisurf:
mei_or <- ordisurf(mei_wa[,-3], mei_wa$label, plot = FALSE)
summary(mei_or)
mei_gr <- expand.grid(x = mei_or$grid$x, y = mei_or$grid$y) #get x and ys
mei_gr$z <- as.vector(mei_or$grid$z) #unravel the matrix for the z scores
mei_gr <- data.frame(na.omit(mei_gr)) #gets rid of the nas
# Predict ordisurf
newdata <- expand.grid(x1=seq(min(mei_md$points[,1]),  max(mei_md$points[,1]), len = 10), x2= seq(min(mei_md$points[,2]),  max(mei_md$points[,2]), len=10))
mei_gr2 <- cbind(newdata, z= predict(mei_or, newdata))
names(mei_gr2) <- c("x", "y", "z")
names(summary(mei_or))
summary(mei_or)$p.table
summary(mei_or)$s.table
# Main effect
f <- adonis(mei_sc2~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
mei_sc2 <- acast(mei_s, Cruise+Habitat+Station+Depth~Class, value.var = "Wt", fun.aggregate=mean, na.rm=TRUE)
mei_sc2[is.na(mei_sc2)] <- 0
fr <- strsplit(row.names(mei_sc2), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Depth")
fr$Depth <- as.numeric(fr$Depth)
# Main effect
f <- adonis(mei_sc2~Habitat+Cruise+Depth+Habitat:Depth+Habitat:Cruise+Depth:Cruise, data=fr, method="bray")
f
summary(f)
names(f)
f$aov.tab
kable(f$aov.tab)
