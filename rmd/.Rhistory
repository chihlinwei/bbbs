stress <- paste("Stress = ", deparse(round(md$stress,2)))
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, e) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=0.1, y=-0.4, label=stress, size=5) +
#scale_fill_viridis(discrete = TRUE)+
#scale_color_viridis(discrete = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
geom_point(data=cbind(md$points, e) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=0.1, y=-0.4, label=stress, size=5) +
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=0.1, y=-0.4, label=stress, size=5) +
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=1, y=-2, label=stress, size=5) +
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=1, y=-2, label=stress, size=5) +
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1, label=stress, size=5) +
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
theme_bw() %+replace% large
?wascores
wascores(md$points, mei_sc)
wa <- wascores(md$points, mei_sc)
row.names(wa)
row.names(wa) %>% as.numeric
wa$labels <- row.names(wa) %>% as.numeric
wa <- wascores(md$points, mei_sc)
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
library(ggrepel)
install.packages("ggrepel")
library(ggrepel)
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
fortify(wa)
wa
wa <- wascores(md$points, mei_sc)
wa <- wascores(md$points, mei_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
wa
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label, colour=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label(data=wa, aes(x=MDS1, y=MDS2, label=label, colour=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label, colour=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label, fill=label), colour="black",
size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label, colour=label),
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
wa
str(wa)
mac_sc <- acast(mac_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
mac_sc <- acast(mac_s, Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mac_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube")
mac_md <- metaMDS(mac_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
wa <- wascores(mac_md$points, mac_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mac_md <- metaMDS(mac_sc^0.25, distance = "bray")
mac_md <- metaMDS(decostand(mac_sc, "log"), distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
wa <- wascores(mac_md$points, mac_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mei_md <- metaMDS(decostand(mei_sc, "log"), distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
mei_md <- metaMDS(decostand(mei_sc, "log"), distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mac_s$Class <- cut(mac_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mac_sc <- acast(mac_s, Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mac_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube")
mac_md <- metaMDS(mac_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
wa <- wascores(mac_md$points, mac_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
# Use functions from Edwards etal. (2017) Methods in Ecology and Evolution 1:57-67
# https://github.com/andrew-edwards/fitting-size-spectra
#source("PLBfunctions.r")
bks <- l2b(c(mei_s$Wt, mac_s$Wt))
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mac_s$Class <- cut(mac_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mac_sc <- acast(mac_s, Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mac_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube")
mac_md <- metaMDS(mac_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
wa <- wascores(mac_md$points, mac_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(bbbs)
library(ggplot2)
library(ggrepel)
library(plyr)
library(doBy)
library(readxl)
library(reshape2)
library(vegan)
#library(devtools)
#install_github("andrew-edwards/sizeSpectra")
#library(sizeSpectra)
large <- theme(legend.title = element_text(size=20),
legend.text = element_text(size=20),
axis.title = element_text(size=20),
axis.text = element_text(size=20))
rotate <- theme(axis.text.x = element_text(size=20, angle=60, hjust=0.5))
# dark theme for ggplot
dark <- theme(plot.background = element_rect(colour = 'NA', fill = 'gray10'),
panel.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.title = element_text(colour = 'white', size=20),
legend.text = element_text(colour = 'white', size=20),
axis.title = element_text(colour = 'white', size=20),
axis.text = element_text(colour = 'white', size=20),
axis.ticks = element_line(colour = 'white'),
panel.border = element_rect(fill = 'NA', colour = 'white'),
panel.grid.major = element_line(colour = 'gray30'),
panel.grid.minor = element_line(colour = 'gray20'))
# log2 bin
l2b <- function(x) 2^( floor(log2(min(x))) : ceiling(log2(max(x))) )
bks <- l2b(c(mei_s$Wt, mac_s$Wt))
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(bbbs)
library(ggplot2)
library(ggrepel)
library(plyr)
library(doBy)
library(readxl)
library(reshape2)
library(vegan)
#library(devtools)
#install_github("andrew-edwards/sizeSpectra")
#library(sizeSpectra)
large <- theme(legend.title = element_text(size=20),
legend.text = element_text(size=20),
axis.title = element_text(size=20),
axis.text = element_text(size=20))
rotate <- theme(axis.text.x = element_text(size=20, angle=60, hjust=0.5))
# dark theme for ggplot
dark <- theme(plot.background = element_rect(colour = 'NA', fill = 'gray10'),
panel.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.title = element_text(colour = 'white', size=20),
legend.text = element_text(colour = 'white', size=20),
axis.title = element_text(colour = 'white', size=20),
axis.text = element_text(colour = 'white', size=20),
axis.ticks = element_line(colour = 'white'),
panel.border = element_rect(fill = 'NA', colour = 'white'),
panel.grid.major = element_line(colour = 'gray30'),
panel.grid.minor = element_line(colour = 'gray20'))
# log2 bin
l2b <- function(x) 2^( floor(log2(min(x))) : ceiling(log2(max(x))) )
bks <- l2b(c(mei_s$Wt, mac_s$Wt))
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mac_s$Class <- cut(mac_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mac_sc <- acast(mac_s, Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mac_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube")
mac_md <- metaMDS(mac_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
wa <- wascores(mac_md$points, mac_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-1.5, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mac_s$Condition
table(mac_s$Condition)
table(mac$Condition)
table(mei$Condition)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(bbbs)
library(ggplot2)
library(ggrepel)
library(plyr)
library(doBy)
library(readxl)
library(reshape2)
library(vegan)
#library(devtools)
#install_github("andrew-edwards/sizeSpectra")
#library(sizeSpectra)
large <- theme(legend.title = element_text(size=20),
legend.text = element_text(size=20),
axis.title = element_text(size=20),
axis.text = element_text(size=20))
rotate <- theme(axis.text.x = element_text(size=20, angle=60, hjust=0.5))
# dark theme for ggplot
dark <- theme(plot.background = element_rect(colour = 'NA', fill = 'gray10'),
panel.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.title = element_text(colour = 'white', size=20),
legend.text = element_text(colour = 'white', size=20),
axis.title = element_text(colour = 'white', size=20),
axis.text = element_text(colour = 'white', size=20),
axis.ticks = element_line(colour = 'white'),
panel.border = element_rect(fill = 'NA', colour = 'white'),
panel.grid.major = element_line(colour = 'gray30'),
panel.grid.minor = element_line(colour = 'gray20'))
# log2 bin
l2b <- function(x) 2^( floor(log2(min(x))) : ceiling(log2(max(x))) )
bks <- l2b(c(mei$Wt, subset(mac, Condition=="C")$Wt))
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mac_s$Class <- cut(mac_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mac_sc <- acast(subset(mac, Condition=="C"), Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(bbbs)
library(ggplot2)
library(ggrepel)
library(plyr)
library(doBy)
library(readxl)
library(reshape2)
library(vegan)
#library(devtools)
#install_github("andrew-edwards/sizeSpectra")
#library(sizeSpectra)
large <- theme(legend.title = element_text(size=20),
legend.text = element_text(size=20),
axis.title = element_text(size=20),
axis.text = element_text(size=20))
rotate <- theme(axis.text.x = element_text(size=20, angle=60, hjust=0.5))
# dark theme for ggplot
dark <- theme(plot.background = element_rect(colour = 'NA', fill = 'gray10'),
panel.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.title = element_text(colour = 'white', size=20),
legend.text = element_text(colour = 'white', size=20),
axis.title = element_text(colour = 'white', size=20),
axis.text = element_text(colour = 'white', size=20),
axis.ticks = element_line(colour = 'white'),
panel.border = element_rect(fill = 'NA', colour = 'white'),
panel.grid.major = element_line(colour = 'gray30'),
panel.grid.minor = element_line(colour = 'gray20'))
# log2 bin
l2b <- function(x) 2^( floor(log2(min(x))) : ceiling(log2(max(x))) )
bks <- l2b(c(mei_s$Wt, mac$Wt))
mei_s$Class <- cut(mei_s$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
mei_sc <- acast(mei_s, Cruise+Habitat+Station+Deployment+Tube+Subcore~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(mei_sc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube", "Subcore")
mei_md <- metaMDS(mei_sc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mei_md$stress,2)))
wa <- wascores(mei_md$points, mei_sc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mei_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mei_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-2, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
mac$Class <- cut(mac$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
macc <- acast(mac, Cruise+Habitat+Station+Deployment+Tube~Class, value.var = "Wt", fun.aggregate=sum)
fr <- strsplit(row.names(macc), split="_") %>%ldply
fr <- cbind(paste(fr$V1, fr$V2, sep="_"), fr[,-1:-2])
names(fr) <- c("Cruise", "Habitat", "Station", "Deployment", "Tube")
mac_md <- metaMDS(macc, distance = "bray")
stress <- paste("Stress = ", deparse(round(mac_md$stress,2)))
wa <- wascores(mac_md$points, macc) %>% as.data.frame
wa$label <- row.names(wa) %>% as.numeric
ggplot(data=cbind(mac_md$points, fr), aes(x=MDS1, y=MDS2, fill=Habitat, colour=Habitat))+
geom_point(pch=21, alpha=0.8, size=5, colour=gray(0, 0.2))+
#geom_point(data=cbind(mac_md$points, fr) %>% subset(Cruise=="OR1_1114"), pch=21, size=2, fill="white", colour="black")+
stat_ellipse(type="norm")+
annotate("text", x=-1.5, y=1.5, label=stress, size=5) +
geom_label_repel(data=wa, aes(x=MDS1, y=MDS2, label=label), colour="black",
fill=gray(1, 0.6), size=4, label.padding = unit(0.2, "lines"), parse = TRUE)+
theme_bw() %+replace% large
knitr::opts_chunk$set(echo = TRUE, warning = FALSE)
library(bbbs)
library(ggplot2)
library(ggrepel)
library(plyr)
library(doBy)
library(readxl)
library(reshape2)
library(vegan)
#library(devtools)
#install_github("andrew-edwards/sizeSpectra")
#library(sizeSpectra)
large <- theme(legend.title = element_text(size=20),
legend.text = element_text(size=20),
axis.title = element_text(size=20),
axis.text = element_text(size=20))
rotate <- theme(axis.text.x = element_text(size=20, angle=60, hjust=0.5))
# dark theme for ggplot
dark <- theme(plot.background = element_rect(colour = 'NA', fill = 'gray10'),
panel.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.background = element_rect(colour = 'NA', fill = 'transparent'),
legend.title = element_text(colour = 'white', size=20),
legend.text = element_text(colour = 'white', size=20),
axis.title = element_text(colour = 'white', size=20),
axis.text = element_text(colour = 'white', size=20),
axis.ticks = element_line(colour = 'white'),
panel.border = element_rect(fill = 'NA', colour = 'white'),
panel.grid.major = element_line(colour = 'gray30'),
panel.grid.minor = element_line(colour = 'gray20'))
# log2 bin
l2b <- function(x) 2^( floor(log2(min(x))) : ceiling(log2(max(x))) )
bks <- l2b(c(mei_s$Wt, subset(mac, Condition=="C)$Wt))
subset(mac, Condition=="C)$Class <- cut(subset(mac, Condition=="C)$Wt, breaks=bks, labels=log10((bks[-28]+bks[-1])/2) %>% round(digits = 1))
